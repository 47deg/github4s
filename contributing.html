<html><head><title>Github4s</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Github4s contributors" /><meta name="description" content="Github API wrapper written in Scala" /><meta name="og:image" content="/github4s/img/poster.png" /><meta name="og:title" content="Github4s" /><meta name="og:site_name" content="Github4s" /><meta name="og:url" content="https://47deg.github.io/github4s/" /><meta name="og:type" content="website" /><meta name="og:description" content="Github API wrapper written in Scala" /><link rel="icon" type="image/png" href="/github4s/img/favicon.png" /><meta name="twitter:title" content="Github4s" /><meta name="twitter:image" content="https://47deg.github.io/github4s/img/poster.png" /><meta name="twitter:description" content="Github API wrapper written in Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/github4s/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/github4s/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/github4s/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/github4s/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/github4s/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/github4s/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/github4s/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/github4s/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/github4s/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/github4s/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/github4s/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/github4s/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/github4s/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/github4s/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/github4s/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/github4s/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/github4s/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/github4s/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/github4s/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/github4s/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/github4s/highlight/styles/default.css" /><link rel="stylesheet" href="/github4s/css/style.css" /><link rel="stylesheet" href="/github4s/css/palette.css" /><link rel="stylesheet" href="/github4s/css/codemirror.css" /><link rel="stylesheet" href="/github4s/css/kazari-style.css" /><link rel="stylesheet" href="/github4s/css/monokai.css" /><link rel="stylesheet" href="/github4s/css/override.css" /></head><body><header id="site-header"><div class="navbar-wrapper navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/github4s/" class="brand"><div class="icon-wrapper"><span>Github4s</span></div></a></div><nav class="text-right"><ul class=""><li><a href="https://github.com/47deg/github4s"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/github4s/docs.html"><i class="fa fa-file-text"></i><span class="hidden-xs">Documentation</span></a></li></ul></nav></div></div><div class="jumbotron" style="background-image:url('/github4s/img/jumbotron_pattern.png')"></div><div><ul class="horizontalNav">                           <li><a class=" active " href="/github4s/contributing.html">Contributing</a></li>  <li><a class="" href="/github4s/changelog.html">Changelog</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><h1 id="contributing">Contributing</h1>

<p>This is a small guide documenting the best way to add support for a new endpoint in Github4s.</p>

<p>As an example, we’ll assume that the endpoint listing the statuses for a specific ref of
the repository API is not part of Github4s and we want Github4s to support it. Documentation for
this endpoint can be found on <a href="https://developer.github.com/v3/repos/statuses/#list-statuses-for-a-specific-ref">developer.github.com</a>.</p>

<p>This endpoint is fairly simple; we need to make a GET request with the repository’s owner and name
as well as the ref for which we want the status in the URL’s path, and Github will send us back a
list of statuses.</p>

<h2 id="source">Source</h2>

<h3 id="domain">Domain</h3>

<p>The first step will be to define the domain for our endpoint which is just a mapping between the
JSONs returned by the Github API and Github4s’ own case classes.</p>

<p>From <a href="https://developer.github.com/v3/repos/statuses/#list-statuses-for-a-specific-ref">the documentation</a>, Github sends a list of statuses which looks like the following:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-07-20T01:19:13Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-07-20T01:19:13Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://ci.example.com/1000/output"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Build has completed successfully"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/repos/octocat/Hello-World/statuses/6dcb09b5b57875f334f61aebed695e2e4193db5e"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous-integration/jenkins"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"creator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"login"</span><span class="p">:</span><span class="w"> </span><span class="s2">"octocat"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"avatar_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/images/error/octocat_happy.gif"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gravatar_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"html_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/octocat"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"followers_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/followers"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"following_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/following{/other_user}"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gists_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/gists{/gist_id}"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"starred_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/starred{/owner}{/repo}"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"subscriptions_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/subscriptions"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"organizations_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/orgs"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"repos_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/repos"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"events_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/events{/privacy}"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"received_events_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.github.com/users/octocat/received_events"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"site_admin"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>Leveraging the existing <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/domain/User.scala">User</a> case class, we can define our <code class="highlighter-rouge">Status</code> case class
as:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Status</span><span class="o">(</span>
    <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
    <span class="n">url</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">state</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">target_url</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
    <span class="n">description</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
    <span class="n">context</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
    <span class="n">creator</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">User</span><span class="o">],</span>
    <span class="n">created_at</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">updated_at</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">)</span>
</code></pre>
</div>

<p>We can put it in the <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/domain/">github4s.free.domain package</a> in the file corresponding to the
API, here: <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/domain/Repository.scala">Repository</a>.</p>

<h2 id="api">API</h2>

<p>Next, we can define the method actually making the HTTP call with the help of
<a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/HttpClient.scala">HttpClient</a>. All the HTTP calls are grouped by API in the
<a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/api/">github4s.free.api package</a> and, since our endpoint belongs to the repository API, we’ll
add our call to <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/api/Repos.scala">Repos</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">listStatuses</span><span class="o">(</span>
    <span class="n">accessToken</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
    <span class="n">headers</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(),</span>
    <span class="n">owner</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">repo</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">ref</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]]</span> <span class="k">=</span>
  <span class="n">httpClient</span><span class="o">.</span><span class="n">get</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]](</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">s</span><span class="s">"repos/$owner/$repo/commits/$ref/statuses"</span><span class="o">,</span> <span class="n">headers</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="algebra">Algebra</h2>

<p>Then, we need to extend the algebra for the corresponding API so it can support our endpoint.
Because our endpoint is part of the repository API, we need to extend the
<a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/algebra/RepositoryOps.scala">RepositoryOp</a> ADT:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">ListStatuses</span><span class="o">(</span>
    <span class="n">owner</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">repo</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">ref</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
    <span class="n">accessToken</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>
<span class="o">)</span> <span class="k">extends</span> <span class="nc">RepositoryOp</span><span class="o">[</span><span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]]</span>
</code></pre>
</div>

<p>We can now expose our endpoint as a <a href="http://typelevel.org/cats/datatypes/freemonad.html">cats.free.Free</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RepositoryOps</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">RepositoryOp</span>, <span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
  <span class="c1">// ...
</span>  <span class="k">def</span> <span class="n">listStatuses</span><span class="o">(</span>
      <span class="n">owner</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">repo</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">ref</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">accessToken</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>
  <span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]]</span> <span class="k">=</span>
    <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">[</span><span class="kt">RepositoryOp</span>, <span class="kt">F</span><span class="o">](</span><span class="nc">ListStatuses</span><span class="o">(</span><span class="n">owner</span><span class="o">,</span> <span class="n">repo</span><span class="o">,</span> <span class="n">ref</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">))</span>
  <span class="c1">// ...
</span><span class="o">}</span>
</code></pre>
</div>

<p>This code belongs to the <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/algebra/">github4s.free.algebra package</a> in the file corresponding
to the API, here: <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/algebra/RepositoryOps.scala">RepositoryOps</a>.</p>

<h2 id="interpreter">Interpreter</h2>

<p>We’re now ready to make <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/free/interpreters/Interpreters.scala">our repository interpreter</a> deal with <code class="highlighter-rouge">ListStatuses</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">repositoryOpsInterpreter</span><span class="k">:</span> <span class="kt">RepositoryOp</span> <span class="kt">~&gt;</span> <span class="kt">K</span> <span class="o">=</span> <span class="k">new</span> <span class="o">(</span><span class="nc">RepositoryOp</span> <span class="o">~&gt;</span> <span class="n">K</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">repos</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Repos</span><span class="o">()</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">RepositoryOp</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">K</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Kleisli</span><span class="o">[</span><span class="kt">M</span>, <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>, <span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">headers</span> <span class="k">=&gt;</span>
    <span class="n">fa</span> <span class="k">match</span> <span class="o">{</span>
      <span class="c1">// ...
</span>      <span class="k">case</span> <span class="nc">ListStatuses</span><span class="o">(</span><span class="n">owner</span><span class="o">,</span> <span class="n">repo</span><span class="o">,</span> <span class="n">ref</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="n">repos</span><span class="o">.</span><span class="n">listStatus</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">owner</span><span class="o">,</span> <span class="n">repo</span><span class="o">,</span> <span class="n">ref</span><span class="o">)</span>
      <span class="c1">// ...
</span>    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="endpoint-wrapper">Endpoint wrapper</h2>

<p>Finally, we’re ready to add our endpoint to the <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/GithubAPIs.scala">GHRepos</a> wrapper:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GHRepos</span><span class="o">(</span><span class="n">accessToken</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">O</span><span class="k">:</span> <span class="kt">RepositoryOps</span><span class="o">[</span><span class="kt">GitHub4s</span><span class="o">])</span> <span class="o">{</span>
  <span class="c1">// ...
</span>  <span class="k">def</span> <span class="n">listStatuses</span><span class="o">(</span>
      <span class="n">owner</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">repo</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">ref</span><span class="k">:</span> <span class="kt">String</span>
  <span class="o">)</span><span class="k">:</span> <span class="kt">GHIO</span><span class="o">[</span><span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]]</span> <span class="k">=</span>
    <span class="n">O</span><span class="o">.</span><span class="n">listStatuses</span><span class="o">(</span><span class="n">owner</span><span class="o">,</span> <span class="n">repo</span><span class="o">,</span> <span class="n">ref</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="coproduct">Coproduct</h2>

<p>Github4s represents the supported APIs as a <code class="highlighter-rouge">Coproduct</code> of ADTs. As a result, if you’re adding
support for an API which is not yet taken into account by Github4s, in our case that would be the
repository API, you will need to add this API to the <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/app.scala">Github4s Coproduct</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">app</span> <span class="o">{</span>
  <span class="c1">// ...
</span>  <span class="k">type</span> <span class="kt">GitHub4s</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">RepositoryOp</span>, <span class="kt">COGHX</span>, <span class="kt">A</span><span class="o">]</span>
<span class="o">}</span>
</code></pre>
</div>

<p>and an entry point to your <a href="#endpoint-wrapper">wrapper</a> in <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/main/scala/github4s/Github.scala">the Github class</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Github</span><span class="o">(</span><span class="n">accessToken</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// ...
</span>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">repos</span>        <span class="k">=</span> <span class="k">new</span> <span class="nc">GHRepos</span><span class="o">(</span><span class="n">accessToken</span><span class="o">)</span>
  <span class="c1">// ...
</span><span class="o">}</span>
</code></pre>
</div>

<h1 id="test">Test</h1>

<p>Now that we’ve written our source code, we’re ready to write the tests.</p>

<h2 id="token">Token</h2>

<p>The first step we need to take in order to run the tests is a valid token which we can provide through an
environment variable:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">GITHUB4S_ACCESS_TOKEN</span><span class="o">=</span>aaaa
</code></pre>
</div>

<p>You can create a token on Github: <a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a>.</p>

<h2 id="integration-tests">Integration tests</h2>

<p>The integration tests are grouped by API in <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/test/scala/github4s/integration/">github4s.integration package</a>. As a result,
we’ll be writing our tests in <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/test/scala/github4s/integration/GHReposSpec.scala">GHReposSpec</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"Repos &gt;&gt; ListStatuses"</span> <span class="n">should</span> <span class="s">"return a non empty list when a valid ref is provided"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Github</span><span class="o">(</span><span class="n">accessToken</span><span class="o">).</span><span class="n">repos</span>
    <span class="o">.</span><span class="n">listStatuses</span><span class="o">(</span><span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validCommitSha</span><span class="o">)</span>
    <span class="o">.</span><span class="n">execFuture</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">headerUserAgent</span><span class="o">)</span>

  <span class="n">testFutureIsRight</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]](</span><span class="n">response</span><span class="o">,</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span>
    <span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">nonEmpty</span> <span class="n">shouldBe</span> <span class="kc">true</span>
    <span class="n">r</span><span class="o">.</span><span class="n">statusCode</span> <span class="n">shouldBe</span> <span class="n">okStatusCode</span>
  <span class="o">})</span>
<span class="o">}</span>

<span class="n">it</span> <span class="n">should</span> <span class="s">"return an empty list when an invalid ref is provided"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Github</span><span class="o">(</span><span class="n">accessToken</span><span class="o">).</span><span class="n">repos</span>
    <span class="o">.</span><span class="n">listStatuses</span><span class="o">(</span><span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">invalidRef</span><span class="o">)</span>
    <span class="o">.</span><span class="n">execFuture</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">headerUserAgent</span><span class="o">)</span>

  <span class="n">testFutureIsRight</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]](</span><span class="n">response</span><span class="o">,</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span>
    <span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">isEmpty</span> <span class="n">shouldBe</span> <span class="kc">true</span>
    <span class="n">r</span><span class="o">.</span><span class="n">statusCode</span> <span class="n">shouldBe</span> <span class="n">okStatusCode</span>
  <span class="o">})</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Be aware that integration tests are only required for GET endpoints (not POST or PATCH) to avoid creating useless stuff on GitHub.</p>

<h2 id="unit-tests">Unit tests</h2>

<p>We can now move on to the unit tests which reside in the <a href="https://github.com/47deg/github4s/tree/master/github4s/shared/src/test/scala/github4s/unit">github4s.unit package</a>. We’re
going to test two things: our <a href="#algebra">algebra</a> and our <a href="#api">API</a>. Here too, the unit tests are
grouped by API which means we’ll be working on <a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/test/scala/github4s/unit/GHReposSpec.scala">GHReposSpec</a> and
<a href="https://github.com/47deg/github4s/blob/master/github4s/shared/src/test/scala/github4s/unit/ReposSpec.scala">ReposSpec</a> respectively.</p>

<h3 id="algebra-spec">Algebra spec</h3>

<p>We’re just verifying that our algebra gets the right parameters from our wrapper defined above:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"GHRepos.listStatuses"</span> <span class="n">should</span> <span class="s">"call to RepositoryOps with the right parameters"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">GitHub4s</span>, <span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]]</span> <span class="k">=</span>
    <span class="nc">Free</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="nc">Right</span><span class="o">(</span><span class="nc">GHResult</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">status</span><span class="o">),</span> <span class="n">okStatusCode</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="n">empty</span><span class="o">)))</span>

  <span class="k">val</span> <span class="n">repoOps</span> <span class="k">=</span> <span class="n">mock</span><span class="o">[</span><span class="kt">RepositoryOpsTest</span><span class="o">]</span>
  <span class="o">(</span><span class="n">repoOps</span><span class="o">.</span><span class="n">listStatuses</span> <span class="k">_</span><span class="o">)</span>
    <span class="o">.</span><span class="n">expects</span><span class="o">(</span><span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validRefSingle</span><span class="o">,</span> <span class="n">sampleToken</span><span class="o">)</span>
    <span class="o">.</span><span class="n">returns</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">ghReposData</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GHRepos</span><span class="o">(</span><span class="n">sampleToken</span><span class="o">)(</span><span class="n">repoOps</span><span class="o">)</span>
  <span class="n">ghReposData</span><span class="o">.</span><span class="n">listStatuses</span><span class="o">(</span><span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validRefSingle</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="api-spec">API spec</h3>

<p>We’re just checking that our API defined above hits the right endpoint, here:
<code class="highlighter-rouge">s"repos/$validRepoOwner/$validRepoName/commits/$validRefSingle/statuses"</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"Repos.listStatuses"</span> <span class="n">should</span> <span class="s">"call htppClient.get with the right parameters"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span><span class="k">:</span> <span class="kt">GHResponse</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Right</span><span class="o">(</span><span class="nc">GHResult</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">status</span><span class="o">),</span> <span class="n">okStatusCode</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="n">empty</span><span class="o">))</span>

  <span class="k">val</span> <span class="n">httpClientMock</span> <span class="k">=</span> <span class="n">httpClientMockGet</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Status</span><span class="o">]](</span>
    <span class="n">url</span> <span class="k">=</span> <span class="n">s</span><span class="s">"repos/$validRepoOwner/$validRepoName/commits/$validRefSingle/statuses"</span><span class="o">,</span>
    <span class="n">response</span> <span class="k">=</span> <span class="n">response</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="n">repos</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Repos</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Id</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">val</span> <span class="n">httpClient</span><span class="k">:</span> <span class="kt">HttpClient</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="n">httpClientMock</span>
  <span class="o">}</span>
  <span class="n">repos</span><span class="o">.</span><span class="n">listStatuses</span><span class="o">(</span><span class="n">sampleToken</span><span class="o">,</span> <span class="n">headerUserAgent</span><span class="o">,</span> <span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validRefSingle</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="jvm-specific-unit-tests">JVM-specific unit tests</h2>

<p>Finally, there are unit tests specific to Github4s on the JVM leveraging <a href="https://github.com/jamesdbloom/mockserver">mock server</a>.</p>

<h3 id="mocking-the-responses">Mocking the responses</h3>

<p>The first step will be to define the responses that will be sent back by the mock server in
<a href="https://github.com/47deg/github4s/blob/master/github4s/jvm/src/test/scala/github4s/utils/MockGithubApiServer.scala">MockGithubApiServer</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="c1">//Repos &gt;&gt; listStatus
</span><span class="n">mockServer</span>
  <span class="o">.</span><span class="n">when</span><span class="o">(</span>
    <span class="n">request</span>
      <span class="o">.</span><span class="n">withMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withPath</span><span class="o">(</span><span class="n">s</span><span class="s">"/repos/$validRepoOwner/$validRepoName/commits/$validRefSingle/statuses"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="n">tokenHeader</span><span class="o">))</span>
  <span class="o">.</span><span class="n">respond</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="n">withStatusCode</span><span class="o">(</span><span class="n">okStatusCode</span><span class="o">).</span><span class="n">withBody</span><span class="o">(</span><span class="n">listStatusValidResponse</span><span class="o">))</span>

<span class="n">mockServer</span>
  <span class="o">.</span><span class="n">when</span><span class="o">(</span>
    <span class="n">request</span>
      <span class="o">.</span><span class="n">withMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withPath</span><span class="o">(</span><span class="n">s</span><span class="s">"/repos/$validRepoOwner/$validRepoName/commits/$validRefSingle/statuses"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withHeader</span><span class="o">(</span><span class="n">not</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">)))</span>
  <span class="o">.</span><span class="n">respond</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="n">withStatusCode</span><span class="o">(</span><span class="n">unauthorizedStatusCode</span><span class="o">).</span><span class="n">withBody</span><span class="o">(</span><span class="n">unauthorizedResponse</span><span class="o">))</span>

<span class="n">mockServer</span>
  <span class="o">.</span><span class="n">when</span><span class="o">(</span>
    <span class="n">request</span>
      <span class="o">.</span><span class="n">withMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withPath</span><span class="o">(</span><span class="n">s</span><span class="s">"/repos/$validRepoOwner/$validRepoName/commits/$invalidRef/statuses"</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withHeader</span><span class="o">(</span><span class="n">not</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">)))</span>
  <span class="o">.</span><span class="n">respond</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="n">withStatusCode</span><span class="o">(</span><span class="n">okStatusCode</span><span class="o">).</span><span class="n">withBody</span><span class="o">(</span><span class="n">emptyListResponse</span><span class="o">))</span>
</code></pre>
</div>

<h3 id="unit-tests-1">Unit tests</h3>

<p>We can now write the unit tests making use of the previous mocks in <a href="https://github.com/47deg/github4s/blob/master/github4s/jvm/src/test/scala/github4s/unit/ApiSpec.scala">ApiSpec</a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"Repos &gt;&gt; ListStatus"</span> <span class="n">should</span> <span class="s">"return the expected statuses when a valid ref is provided"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span> <span class="k">=</span>
    <span class="n">repos</span><span class="o">.</span><span class="n">listStatus</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">headerUserAgent</span><span class="o">,</span> <span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validRefSingle</span><span class="o">)</span>
  <span class="n">response</span> <span class="n">should</span> <span class="n">be</span><span class="o">(</span><span class="ss">'right)</span>

  <span class="n">response</span><span class="o">.</span><span class="n">toOption</span> <span class="n">map</span> <span class="o">{</span> <span class="n">r</span> <span class="k">⇒</span>
    <span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">nonEmpty</span> <span class="n">shouldBe</span> <span class="kc">true</span>
    <span class="n">r</span><span class="o">.</span><span class="n">statusCode</span> <span class="n">shouldBe</span> <span class="n">okStatusCode</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">it</span> <span class="n">should</span> <span class="s">"return an error if no tokens are provided"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span> <span class="k">=</span>
    <span class="n">repos</span><span class="o">.</span><span class="n">listStatus</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="n">headerUserAgent</span><span class="o">,</span> <span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">validRefSingle</span><span class="o">)</span>
  <span class="n">response</span> <span class="n">should</span> <span class="n">be</span><span class="o">(</span><span class="ss">'left)</span>
<span class="o">}</span>

<span class="n">it</span> <span class="n">should</span> <span class="s">"return an empty list when an invalid ref is passed"</span> <span class="n">in</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">response</span> <span class="k">=</span>
    <span class="n">repos</span><span class="o">.</span><span class="n">listStatus</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">headerUserAgent</span><span class="o">,</span> <span class="n">validRepoOwner</span><span class="o">,</span> <span class="n">validRepoName</span><span class="o">,</span> <span class="n">invalidRef</span><span class="o">)</span>
  <span class="n">response</span> <span class="n">should</span> <span class="n">be</span><span class="o">(</span><span class="ss">'right)</span>

  <span class="n">response</span><span class="o">.</span><span class="n">toOption</span> <span class="n">map</span> <span class="o">{</span> <span class="n">r</span> <span class="k">⇒</span>
    <span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">isEmpty</span> <span class="n">shouldBe</span> <span class="kc">true</span>
    <span class="n">r</span><span class="o">.</span><span class="n">statusCode</span> <span class="n">shouldBe</span> <span class="n">okStatusCode</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h1 id="documentation">Documentation</h1>

<p>Finally, we can add documentation to http://47deg.github.io/github4s/. Github4s uses
<a href="https://github.com/47deg/sbt-microsites">sbt-microsites</a> and <a href="https://github.com/tpolecat/tut">tut</a>
to generate and publish its documentation.</p>

<p>It shouldn’t come as a surprise at this point, but the documentation is grouped by API. As a result,
we’ll add documentation to <a href="https://github.com/47deg/github4s/blob/master/docs/src/main/tut/repository.md">repository.md</a>:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>### List statuses for a specific Ref


You can also list status through `listStatuses`, it takes as arguments:

- the repository coordinates (`owner` and `name` of the repository).
- a git ref (a `SHA`, a branch `name` or a tag `name`).

To list the statuses for a specific ref:

{triple backtick}tut:silent
val listStatuses =
  Github(accessToken).repos.listStatuses("47deg", "github4s", "heads/master")

listStatuses.exec[cats.Id, HttpResponse[String]]() match {
  case Left(e) =&gt; println(s"Something went wrong: ${e.getMessage}")
  case Right(r) =&gt; println(r.result)
}
{triple backtick}

The `result` on the right is the corresponding [List[Status]][repository-scala].

See [the API doc](https://developer.github.com/v3/repos/statuses/#list-statuses-for-a-specific-ref)
for full reference.
</code></pre>
</div>

<p>Once the documentation is written, we can build it locally with:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sbt makeMicrosite
<span class="nb">cd </span>docs/target/site/ <span class="o">&amp;&amp;</span> jekyll serve
</code></pre>
</div>

</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>Github4s is designed and developed by <a href="https://github.com/47deg/github4s/blob/master/AUTHORS.md" target="_blank">Github4s contributors</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/47deg/github4s"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/github4s/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: '47deg/github4s'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script></body></html>